import{Matrix4 as e,Object3D as t,Quaternion as r,Vector3 as n}from"./three.module.js";let _position=new n,_quaternion=new r,_scale=new n;class CSS3DObject extends t{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}class CSS3DSprite extends CSS3DObject{constructor(e){super(e),this.isCSS3DSprite=!0,this.rotation2D=0}copy(e,t){return super.copy(e,t),this.rotation2D=e.rotation2D,this}}let _matrix=new e,_matrix2=new e;class CSS3DRenderer{constructor(e={}){let t=this,r,n,i,s,l={camera:{fov:0,style:""},objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");o.style.overflow="hidden",this.domElement=o;let a=document.createElement("div");function m(e){return 1e-10>Math.abs(e)?0:e}function c(e){let t=e.elements;return"matrix3d("+m(t[0])+","+m(-t[1])+","+m(t[2])+","+m(t[3])+","+m(t[4])+","+m(-t[5])+","+m(t[6])+","+m(t[7])+","+m(t[8])+","+m(-t[9])+","+m(t[10])+","+m(t[11])+","+m(t[12])+","+m(-t[13])+","+m(t[14])+","+m(t[15])+")"}function p(e){let t=e.elements,r="matrix3d("+m(t[0])+","+m(t[1])+","+m(t[2])+","+m(t[3])+","+m(-t[4])+","+m(-t[5])+","+m(-t[6])+","+m(-t[7])+","+m(t[8])+","+m(t[9])+","+m(t[10])+","+m(t[11])+","+m(t[12])+","+m(t[13])+","+m(t[14])+","+m(t[15])+")";return"translate(-50%,-50%)"+r}function d(e,r,n,i){if(e.isCSS3DObject){let s=!0===e.visible&&!0===e.layers.test(n.layers);if(e.element.style.display=!0===s?"":"none",!0===s){e.onBeforeRender(t,r,n);let o;e.isCSS3DSprite?(_matrix.copy(n.matrixWorldInverse),_matrix.transpose(),0!==e.rotation2D&&_matrix.multiply(_matrix2.makeRotationZ(e.rotation2D)),e.matrixWorld.decompose(_position,_quaternion,_scale),_matrix.setPosition(_position),_matrix.scale(_scale),_matrix.elements[3]=0,_matrix.elements[7]=0,_matrix.elements[11]=0,_matrix.elements[15]=1,o=p(_matrix)):o=p(e.matrixWorld);let m=e.element,c=l.objects.get(e);if(void 0===c||c.style!==o){m.style.transform=o;let h={style:o};l.objects.set(e,h)}m.parentNode!==a&&a.appendChild(m),e.onAfterRender(t,r,n)}}for(let x=0,u=e.children.length;x<u;x++)d(e.children[x],r,n,i)}a.style.transformStyle="preserve-3d",a.style.pointerEvents="none",o.appendChild(a),this.getSize=function(){return{width:r,height:n}},this.render=function(e,t){let r=t.projectionMatrix.elements[5]*s;l.camera.fov!==r&&(o.style.perspective=t.isPerspectiveCamera?r+"px":"",l.camera.fov=r),!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld();let n,p;t.isOrthographicCamera&&(n=-(t.right+t.left)/2,p=(t.top+t.bottom)/2);let h=t.isOrthographicCamera?"scale("+r+")translate("+m(n)+"px,"+m(p)+"px)"+c(t.matrixWorldInverse):"translateZ("+r+"px)"+c(t.matrixWorldInverse),x=h+"translate("+i+"px,"+s+"px)";l.camera.style!==x&&(a.style.transform=x,l.camera.style=x),d(e,e,t,h)},this.setSize=function(e,t){r=e,n=t,i=r/2,s=n/2,o.style.width=e+"px",o.style.height=t+"px",a.style.width=e+"px",a.style.height=t+"px"}}}export{CSS3DObject,CSS3DSprite,CSS3DRenderer};